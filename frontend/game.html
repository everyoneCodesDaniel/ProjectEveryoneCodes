<!DOCTYPE html>
<html>
<head>
<title>Browsergame</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AD09PRo+Pj4MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+Pj4MPj49Gv///wAAAAAAMDAwVS0tLc4rKyv+LCws7jU1NSoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0NDQqLCws7isrK/4tLS3OMTExVCsrK/AqKir/Kysr/ysrK/8uLi6qAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALi4uqisrK/8rKyv/Kioq/ywsLPAsLCzjKioq/zIyMv9UVFT/NTU1/DQzMy8tLS0KLS0tCi0tLQotLS0KMzMzLzk5OfxQUFD/LS0t/ysqKv8sLCzjLS0tni4uLv9PT0//8fHx/1VVVf8uLi79Ly8v/DQ0NPw0NDT8Ly8v/DAwMP1vb2///////z8/P/8tLS3/Li4tnjAwMFdtbW3/+fn5/7i4uP/7+/v/dHR0/39/f//9/f3//Pz8/4KCgv+dnZ3//////6mpqf//////U1NT/zAvL1dAQEAUQ0ND+3Fxcf/9/f3/c3Nz/0VFRf9IR0z/Y1iI/1iHaf9ITkr/TU1N/5WVlf//////dnZ2/zw8PPs9PT0U////AC0tLcc8PDz/hISE/0BAQP8rKir/Kyor/ysqLv8qLiv/Kisr/ysqKv9MTEz/oqKi/zIyMv8tLS3H////AAAAAAA0MzNKQEBA/z09Pf89PT3/LS0t3iwsLNssLCzbLCws2ywsLNsvLy/jPT09/z09Pf8+Pj76MzMzRQAAAAAAAAAA////AI+PjzyUlJRDkJCQPnl5eQIAAAAAAAAAAAAAAAAAAAAAeHh4BpOTkkGUlJRDjo6ONAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAAj/EAAAfgAAAH4AAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAQAAg8MAAP//AAD//wAA//8AAA==" rel="icon" type="image/x-icon">

<link rel="stylesheet" type="text/css" href="game.css">

</head>
<body onload="startMonolog();checkPlayer();">

<audio id="monsterSound">
    <source src="/sound/monster.ogg" type="audio/ogg">
</audio>
<audio id="blockSound">
    <source src="/sound/shield.ogg" type="audio/ogg">
</audio>
<audio id="slashSound">
    <source src="/sound/slash.ogg" type="audio/ogg">
</audio>
<audio id="splatSound">
    <source src="/sound/splat.ogg" type="audio/ogg">
</audio>
<audio id="screamSound">
    <source src="/sound/scream.ogg" type="audio/ogg">
</audio>
<audio id="WinSound">
    <source src="/sound/applause.ogg" type="audio/ogg">
</audio>

<div id="canvas">
    <img class="gameMap" src="/img/Abandoned_Map.png" >

    <img class="mapCover" id="X1/Y1" src="/img/Cover.png" style="vertical-align:middle;margin:0px 0px">
    <img class="mapCover" id="X2/Y1" src="/img/Cover.png" style="vertical-align:middle;margin:0px 120px">
    <img class="mapCover" id="X3/Y1" src="/img/Cover.png" style="vertical-align:middle;margin:0px 240px">
    <img class="monster" id="monster1" src="/img/skull.png" style="vertical-align:middle;margin:0px 240px">
    <img class="mapCover" id="X4/Y1" src="/img/Cover.png" style="vertical-align:middle;margin:0px 360px">
    <img class="mapCover" id="X5/Y1" src="/img/Cover.png" style="vertical-align:middle;margin:0px 480px">
    <img class="mapCover" id="X6/Y1" src="/img/Cover.png" style="vertical-align:middle;margin:0px 600px">

    <img class="mapCover" id="X1/Y2" src="/img/Cover.png" style="vertical-align:middle;margin:120px 0px">
    <img class="monster" id="monster2" src="/img/skull.png" style="vertical-align:middle;margin:120px 0px">
    <img class="mapCover" id="X2/Y2" src="/img/Cover.png" style="vertical-align:middle;margin:120px 120px">
    <img class="mapCover" id="X3/Y2" src="/img/Cover.png" style="vertical-align:middle;margin:120px 240px">
    <img class="mapCover" id="X4/Y2" src="/img/Cover.png" style="vertical-align:middle;margin:120px 360px">
    <img class="mapCover" id="X5/Y2" src="/img/Cover.png" style="vertical-align:middle;margin:120px 480px">
    <img class="mapCover" id="X6/Y2" src="/img/Cover.png" style="vertical-align:middle;margin:120px 600px">

    <img class="mapCover" id="X1/Y3" src="/img/Cover.png" style="vertical-align:middle;margin:240px 0px">
    <img class="mapCover" id="X2/Y3" src="/img/Cover.png" style="vertical-align:middle;margin:240px 120px">
    <!-----------------------------------Startposition---X3/Y3-------------------------------------------->
    <img class="mapCover" id="X3/Y3" src="/img/Cover.png" style="vertical-align:middle;margin:240px 240px" hidden>
    <!-----------------------------------Startposition---X3/Y3-------------------------------------------->   
    <img class="mapCover" id="X4/Y3" src="/img/Cover.png" style="vertical-align:middle;margin:240px 360px">
    <img class="mapCover" id="X5/Y3" src="/img/Cover.png" style="vertical-align:middle;margin:240px 480px">
    <img class="mapCover" id="X6/Y3" src="/img/Cover.png" style="vertical-align:middle;margin:240px 600px">

    <img class="mapCover" id="X1/Y4" src="/img/Cover.png" style="vertical-align:middle;margin:360px 0px">
    <img class="mapCover" id="X2/Y4" src="/img/Cover.png" style="vertical-align:middle;margin:360px 120px">
    <img class="monster" id="monster3" src="/img/skull.png" style="vertical-align:middle;margin:360px 120px">
    <img class="mapCover" id="X3/Y4" src="/img/Cover.png" style="vertical-align:middle;margin:360px 240px">
    <img class="mapCover" id="X4/Y4" src="/img/Cover.png" style="vertical-align:middle;margin:360px 360px">
    <img class="mapCover" id="X5/Y4" src="/img/Cover.png" style="vertical-align:middle;margin:360px 480px">
    <img class="mapCover" id="X6/Y4" src="/img/Cover.png" style="vertical-align:middle;margin:360px 600px">

    <img class="mapCover" id="X1/Y5" src="/img/Cover.png" style="vertical-align:middle;margin:480px 0px">
    <img class="mapCover" id="X2/Y5" src="/img/Cover.png" style="vertical-align:middle;margin:480px 120px">
    <img class="mapCover" id="X3/Y5" src="/img/Cover.png" style="vertical-align:middle;margin:480px 240px">
    <img class="mapCover" id="X4/Y5" src="/img/Cover.png" style="vertical-align:middle;margin:480px 360px">
    <img class="mapCover" id="X5/Y5" src="/img/Cover.png" style="vertical-align:middle;margin:480px 480px">
    <img class="mapCover" id="X6/Y5" src="/img/Cover.png" style="vertical-align:middle;margin:480px 600px">

    <img class="mapCover" id="X1/Y6" src="/img/Cover.png" style="vertical-align:middle;margin:600px 0px">
    <img class="mapCover" id="X2/Y6" src="/img/Cover.png" style="vertical-align:middle;margin:600px 120px">
    <img class="mapCover" id="X3/Y6" src="/img/Cover.png" style="vertical-align:middle;margin:600px 240px">
    <img class="monster" id="monster4" src="/img/skull.png" style="vertical-align:middle;margin:600px 240px">
    <img class="mapCover" id="X4/Y6" src="/img/Cover.png" style="vertical-align:middle;margin:600px 360px">
    <img class="mapCover" id="X5/Y6" src="/img/Cover.png" style="vertical-align:middle;margin:600px 480px">
    <img class="mapCover" id="X6/Y6" src="/img/Cover.png" style="vertical-align:middle;margin:600px 600px">
    <img class="monster" id="monster5" src="/img/skull.png" style="vertical-align:middle;margin:600px 600px">
</div>

<div id="inventory">
    <h3 style="text-align: center;">Inventory</h3>
    <img class="picleft" id="rustyKey" src="/img/rustyKey.png" onclick="chatInput.value += ' rustyKey ';document.getElementById('chatInput').focus();">   
    <img class="picright" id="doll" src="/img/doll.png" onclick="chatInput.value += ' doll ';document.getElementById('chatInput').focus();"><br>
    <span class="spanleft" id="rustyKeytext" hidden>RustyKey</span>
    <span class="spanright" id="dollText" style="padding-right: 56px;" hidden>Doll</span>
    <br><br>
    <img class="picleft" id="casket" src="/img/casket.png" onclick="casket()" >
    <img class="picright" id="bottle" src="/img/bottle.png" onclick="bottle()" >
    <br><span class="spanleft" id="casketText" hidden>Casket</span>
    <span class="spanright" id="bottleText" style="padding-right: 40px;" hidden>Bottle</span>
    <br><br>
    <img class="picleft" id="redOrb" src="/img/redOrb.png" onclick="chatInput.value += ' redOrb ';document.getElementById('chatInput').focus();" >
    <img class="picright" id="greenOrb" src="/img/greenOrb.png" onclick="chatInput.value += ' greenOrb ';document.getElementById('chatInput').focus();" ><br>
    <span class="spanleft" id="redOrbText" hidden>Red Orb</span>
    <span class="spanright" id="greenOrbText" style="padding-right: 13px;" hidden>Green Orb</span>
    <br><br>
    <img class="picleft" id="blueOrb" src="/img/blueOrb.png" onclick="chatInput.value += ' blueOrb ';document.getElementById('chatInput').focus();" >
    <img class="picright" id="shield" src="/img/shield.png" onclick="shieldDescription()" ><br>
    <span class="spanleft" id="blueOrbText" hidden>Blue Orb</span>
    <span class="spanright" id="shieldText" style="padding-right: 40px;" hidden>Shield</span>
    <br>
<div id="help">
    <h3 style="text-align: center;">Help</h3>
    <span class="left">look</span>
    <span class="right">north/n</span><br><br>
    <span class="left">pickup</span>
    <span class="right">south/s</span><br><br>
    <span class="left">use <em>item</em></span>
    <span class="right">east/e</span><br><br>
    <span class="left">talk</span>
    <span class="right">west/w</span><br>
    <h3 style="text-align: center;">Legend</h3>
    <span class="left"><span class="items"></span> Items</span>
    <span class="right">Chests <span class="chest"></span></span><br>
    <span class="left"><span class="npc"></span> NPC</span>
    <span class="right">Sign <span class="sign"></span></span><br>
    <span class="left"><span class="tree"></span> Tree</span>
    <span class="right">Altar <span class="altar"></span></span><br>
    <span class="left"><span class="pentagramm"></span> Pentagramm</span>
    <span class="right">Gate <span class="gate"></span></span><br><br>
    <audio id="music" controls>
        <source src="/sound/backgroundMusic.ogg" type="audio/ogg">
    </audio>

</div>
</div>

<div id="input">
<span style="color: white; font-size: 1.17em;">Input</span><br><br>
<span style="color: white;" id="coordinates">X = <span id="X"></span>  Y = <span id="Y"></span></span>
<div class="chat-container" id="chatWindow"></div>
<div class="send-container" id="send-container">
    <form action="javascript:sendMessage(chatInput)">
        <input type="text" name="chatInput" id="chatInput" style="width: 220px; font-size:20px" autocomplete="off">
        <input id="send" type="submit" value="send" style="font-size:20px; width: fit-content; padding: 5px 5px; font-family: Monaco, monospace; font-weight: bold;">
    </form>
</div>
<button id="uncover" onclick="uncover()" hidden>Uncover</button>
<button id="showall" onclick="showItems()" hidden>Show all items</button>
<button id="exit" onclick="exitGame()" hidden>Exit</button>
<button id="won" onclick="wonGame()" hidden>Won</button>
</div>

<script>
    //------------------Initialisation--------------------->
    username = sessionStorage.getItem("player") || "guest";
    var music = document.getElementById("music");
    var x = 3, y = 3, input;
    var items = [], events = [], npc = [];
    generateEvents();
    var saveInput = true;
    var pathOK = false;
    var northOK = false;
    var southOK = false;
    var eastOK = false;
    var westOK = false;
    var scorePoints = 0;
    var turns = 0;
    var validUse = false;
    var lookDB = false;
    var pickupDB = false;
    var useDB = false;
    var talkDB = false;
    document.getElementById("X").innerHTML = x;
    document.getElementById("Y").innerHTML = y;
    var container = document.getElementById('canvas');
    initCanvas(container);
    //----------------------------------------------------->

    function playMusic() {
        music.loop = true;
    }

    function checkPlayer() {
        var player = null || sessionStorage.getItem("player");
        if (player === 'Aymara' || player === "Daniel") {
            document.getElementById('uncover').hidden = false;
            document.getElementById('showall').hidden = false;
            document.getElementById('exit').hidden = false;
            document.getElementById('won').hidden = false;
        } else {
            document.getElementById('uncover').hidden = true;
            document.getElementById('showall').hidden = true;
            document.getElementById('exit').hidden = true;
            document.getElementById('won').hidden = true;
        }
    }

    function clamp(number, min, max) {
        return Math.max(min, Math.min(number, max));
    }

    function sendMessage(chatInput) {
        if (saveInput) {
            input = chatInput.value.toLowerCase().trim();
            var chatWindow = document.getElementById("chatWindow");
            if (chatInput.value.trim().length > 0) {
                var msg = chatInput.value;
                input = input.split(' ');
                console.log("input1: " + input);
                for (var i = 1; i < input.length-1; i++) {
                    if (input[i] == " " || input[i] == "") {
                        input.splice(i, 1);
                        console.log("input: " + i);
                    }
                }
                if (chatInput.value.startsWith("/")) {
                    chatWindow.innerHTML = "<p><b>" + chatWindow.innerHTML +
                        "<i> " + username + ": </i></b>" +
                        msg + "</p>";
                }
                else if (input[0] == "north" || input[0] == "n") {
                    input = "north";
                    cellAction();
                } 
                else if (input[0] == "south" || input[0] == "s") {
                    input = "south";
                    cellAction();
                }
                else if (input[0] == "east" || input[0] == "e") {
                    input = "east";
                    cellAction();
                }
                else if (input[0] == "west" || input[0] == "w") {
                    input = "west";
                    cellAction();
                }
                else if (input[0] == "look") { 
                    input = "look";           
                    cellAction();
                    drawEventLocation();
                }
                else if (input[0] == "pickup" || input[0] == "pick" && input[1] == "up" || input[0] == "take") {    
                    input = "pickup";      
                    cellAction();
                    drawPlayerLocation()
                }
                else if (input[0] == "use" || input[1] == "use") {   
                    validUse = false;
                    for (let i = 0; i <= items.length-1; i++) {
                        if (input[0] == items[i][0] && items[i][2] == true) {
                            console.log("Input1: " + i);
                            input[0] = items[i][0];
                            validUse = true;
                            break;
                        } else if (input[1] == items[i][0] && items[i][2] == true) {
                            console.log("Input2: " + i);
                            input[1] = items[i][0];
                            validUse = true;
                            break;
                        }
                    }
                    if (validUse) {
                        console.log("Cellaction");
                        if (input[0] == "use" &&  input[1] == "casket" || input[0] == "casket" && input[1] == "use") { //---Use-Casket--->
                            casket();
                        } else {
                            cellAction();
                        }
                    } else {
                        incorrectInput();
                    }
                    
                }
                else if (input[0] == "talk") {
                    input = "talk";            
                    cellAction();
                    drawEventLocation();
                }
                //Incorrect Input!
                else {
                    incorrectInput();
                }
            }
        }
    }
    
    function incorrectInput() {
        var blockMessage = "Not a valid input!";
        chatInput.value = "";
        var reserve = chatWindow.innerHTML;
        chatWindow.innerHTML = "<p><b>" + chatWindow.innerHTML + "<i> " + "Warning" + ": </i></b>" + blockMessage.fontcolor("red") + "</p>";
        chatWindow.scrollTo(0,chatWindow.scrollHeight);
        saveInput = !saveInput;
        setTimeout(function() {
            chatWindow.innerHTML = reserve;
            saveInput = !saveInput;
            chatWindow.scrollTo(0,chatWindow.scrollHeight);
        }, 1000);
    }

    function drawPlayerLocation() {
        clearTo();
        let cellCenter = 60;
        let pointX = (canvas.node.width / 6 ) * x - cellCenter;
        let pointY = (canvas.node.height / 6 ) * y - cellCenter;
        let radius = 15;
        let circlefillColor = '#8800ff';
        fillCircle(pointX, pointY, radius, circlefillColor);
        document.getElementById('X'+x+'/'+'Y'+y).hidden = true;
        drawEventLocation();
        drawGrid();
        if ( x == 5 && y == 5) {
            fillCircle(pointX, pointY, radius, circlefillColor);
        }
    }

    function drawEventLocation() {
        let eventX, eventY, radius;
        let circlefillColor;
        //---------------------------Events-------------------------->
        if (document.getElementById('X3/Y3').hidden == true) { //startSign
            eventX = (canvas.node.width / 6 ) * 3 - 90;
            eventY = (canvas.node.height / 6 ) * 3 - 90;
            circlefillColor = '#f0951d'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X2/Y3').hidden == true) { //chest
            eventX = (canvas.node.width / 6 ) * 2 - 60;
            eventY = (canvas.node.height / 6 ) * 3 - 95;
            circlefillColor = '#964B00'; 
            radius = 15;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X2/Y2').hidden == true) { //codeSign
            eventX = (canvas.node.width / 6 ) * 2 - 90;
            eventY = (canvas.node.height / 6 ) * 2 - 90;
            circlefillColor = '#f0951d'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X6/Y5').hidden == true) { //ritualSign
            eventX = (canvas.node.width / 6 ) * 6 - 90;
            eventY = (canvas.node.height / 6 ) * 5 - 90;
            circlefillColor = '#f0951d'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X5/Y3').hidden == true) { //useSign
            eventX = (canvas.node.width / 6 ) * 5 - 90;
            eventY = (canvas.node.height / 6 ) * 3 - 90;
            circlefillColor = '#f0951d'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X1/Y1').hidden == true) { //altarRed
            eventX = (canvas.node.width / 6 ) * 1 - 60;
            eventY = (canvas.node.height / 6 ) * 1 - 95;
            circlefillColor = '#4b4846'; 
            radius = 15;
            fillCircle(eventX, eventY, radius, circlefillColor);
            if (events[4][1]) {
                eventX = (canvas.node.width / 6 ) * 1 - 60;
                eventY = (canvas.node.height / 6 ) * 1 - 95;
                circlefillColor = '#FF0000'; 
                radius = 7;
                fillCircle(eventX, eventY, radius, circlefillColor);
            }
        }
        if (document.getElementById('X6/Y1').hidden == true) { //altarGreen
            eventX = (canvas.node.width / 6 ) * 6 - 60;
            eventY = (canvas.node.height / 6 ) * 1 - 95;
            circlefillColor = '#4b4846'; 
            radius = 15;
            fillCircle(eventX, eventY, radius, circlefillColor);
            if (events[5][1]) {
                eventX = (canvas.node.width / 6 ) * 6 - 60;
                eventY = (canvas.node.height / 6 ) * 1 - 95;
                circlefillColor = '#00FF00'; 
                radius = 7;
                fillCircle(eventX, eventY, radius, circlefillColor);
            }
        }
        if (document.getElementById('X4/Y4').hidden == true) { //altarBlue
            eventX = (canvas.node.width / 6 ) * 4 - 60;
            eventY = (canvas.node.height / 6 ) * 4 - 95;
            circlefillColor = '#4b4846'; 
            radius = 15;
            fillCircle(eventX, eventY, radius, circlefillColor);
            if (events[6][1]) {
                eventX = (canvas.node.width / 6 ) * 4 - 60;
                eventY = (canvas.node.height / 6 ) * 4 - 95;
                circlefillColor = '#0000FF'; 
                radius = 7;
                fillCircle(eventX, eventY, radius, circlefillColor);
            }
        }
        if (document.getElementById('X5/Y2').hidden == true) { //tree
            eventX = (canvas.node.width / 6 ) * 5 - 60;
            eventY = (canvas.node.height / 6 ) * 2 - 95;
            circlefillColor = '#054709'; 
            radius = 15;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X5/Y5').hidden == true) { //Pentagramm
            eventX = (canvas.node.width / 6 ) * 5 - 60;
            eventY = (canvas.node.height / 6 ) * 5 - 60;
            circlefillColor = '#cc0707'; 
            radius = 30;
            fillCircle(eventX, eventY, radius, circlefillColor);
            drawPentagramm(eventX, eventY);
        }
        if (document.getElementById('X6/Y3').hidden == true) { //goldenKey Gate
            if (events[2][1]) {
                eventX = (canvas.node.width / 6 ) * 6 - 110;
                eventY = (canvas.node.height / 6 ) * 3 - 130;
                rectangleColor = '#181513'; 
                let l = 20;
                let b = 20;
                fillRectangle(eventX, eventY, l, b, rectangleColor);
                eventX = (canvas.node.width / 6 ) * 6 - 30;
                eventY = (canvas.node.height / 6 ) * 3 - 130;
                fillRectangle(eventX, eventY, l, b, rectangleColor);
            } else {
                eventX = (canvas.node.width / 6 ) * 6 - 110;
                eventY = (canvas.node.height / 6 ) * 3 - 130;
                rectangleColor = '#181513'; 
                let l = 100;
                let b = 20;
                fillRectangle(eventX, eventY, l, b, rectangleColor);
            }
        }
        if (npc[3][2] && document.getElementById('X6/Y2').hidden == true) { //Hunterblood
            eventX = (canvas.node.width / 6 ) * 6 - 60;
            eventY = (canvas.node.height / 6 ) * 2 - 100;
            circlefillColor = '#cc0707'; 
            radius = 5;
            fillCircle(eventX, eventY, radius, circlefillColor);
            eventX = (canvas.node.width / 6 ) * 6 - 30;
            eventY = (canvas.node.height / 6 ) * 2 - 60;
            fillCircle(eventX, eventY, radius, circlefillColor);
            eventX = (canvas.node.width / 6 ) * 6 - 40;
            eventY = (canvas.node.height / 6 ) * 2 - 100;
            fillCircle(eventX, eventY, radius, circlefillColor);
            eventX = (canvas.node.width / 6 ) * 6 - 20;
            eventY = (canvas.node.height / 6 ) * 2 - 75;
            fillCircle(eventX, eventY, radius, circlefillColor);
            eventX = (canvas.node.width / 6 ) * 6 - 45;
            eventY = (canvas.node.height / 6 ) * 2 - 90;
            fillCircle(eventX, eventY, radius, circlefillColor);
            eventX = (canvas.node.width / 6 ) * 6 - 40;
            eventY = (canvas.node.height / 6 ) * 2 - 40;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X1/Y4').hidden == true) { //finishGame Gate
            if (events[4][1] && events[5][1] && events[6][1]) {
                eventX = (canvas.node.width / 6 ) * 1 - 120;
                eventY = (canvas.node.height / 6 ) * 4 - 110;
                rectangleColor = '#181513'; 
                let l = 10;
                let b = 20;
                fillRectangle(eventX, eventY, l, b, rectangleColor);
                eventX = (canvas.node.width / 6 ) * 1 - 120;
                eventY = (canvas.node.height / 6 ) * 4 - 30;
                fillRectangle(eventX, eventY, l, b, rectangleColor);
            } else {
                eventX = (canvas.node.width / 6 ) * 1 - 120;
                eventY = (canvas.node.height / 6 ) * 4 - 110;
                rectangleColor = '#181513'; 
                let l = 10;
                let b = 100;
                fillRectangle(eventX, eventY, l, b, rectangleColor);
            }
        }
        //----------------------------Items-------------------------->
        if (items[0][1] && document.getElementById('rustyKeytext').hidden == true) { //Key1
            eventX = (canvas.node.width / 6 ) * 1 - 90;
            eventY = (canvas.node.height / 6 ) * 3 - 30;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (events[0][1] && document.getElementById('dollText').hidden == true) { //doll
            eventX = (canvas.node.width / 6 ) * 2 - 60;
            eventY = (canvas.node.height / 6 ) * 3 - 95;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (!items[5][2] && document.getElementById('X2/Y1').hidden == true) { //greenOrb
            eventX = (canvas.node.width / 6 ) * 2 - 90;
            eventY = (canvas.node.height / 6 ) * 1 - 30;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (items[9][3] && !items[4][2] && document.getElementById('X5/Y5').hidden == true) { //redOrb
            eventX = (canvas.node.width / 6 ) * 5 - 90;
            eventY = (canvas.node.height / 6 ) * 5 - 30;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (items[6][1] && !items[6][2] && document.getElementById('X4/Y6').hidden == true) { //blueOrb
            eventX = (canvas.node.width / 6 ) * 4 - 90;
            eventY = (canvas.node.height / 6 ) * 6 - 30;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (items[2][1] && document.getElementById('casketText').hidden == true) { //Casket
            eventX = (canvas.node.width / 6 ) * 2 - 90;
            eventY = (canvas.node.height / 6 ) * 5 - 30;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (items[7][1] && document.getElementById('shieldText').hidden == true) { //Shield
            eventX = (canvas.node.width / 6 ) * 5 - 90;
            eventY = (canvas.node.height / 6 ) * 1 - 30;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (items[3][1] && document.getElementById('bottleText').hidden == true) { //bottle
            eventX = (canvas.node.width / 6 ) * 6 - 90;
            eventY = (canvas.node.height / 6 ) * 4 - 30;
            circlefillColor = '#FFD700'; 
            radius = 10;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        //----------------------------NPCs--------------------------->
        if (document.getElementById('X3/Y4').hidden == true) { //girl
            eventX = (canvas.node.width / 6 ) * 3 - 30;
            eventY = (canvas.node.height / 6 ) * 4 - 90;
            circlefillColor = '#0f0cc5'; 
            radius = 12;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X4/Y2').hidden == true) { //guy
            eventX = (canvas.node.width / 6 ) * 4 - 30;
            eventY = (canvas.node.height / 6 ) * 2 - 90;
            circlefillColor = '#0f0cc5'; 
            radius = 12;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (document.getElementById('X6/Y2').hidden == true) { //hunter
            eventX = (canvas.node.width / 6 ) * 6 - 30;
            eventY = (canvas.node.height / 6 ) * 2 - 90;
            circlefillColor = '#0f0cc5'; 
            radius = 12;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (npc[3][2] && document.getElementById('X6/Y2').hidden == true) { //Hunterblood
            eventX = (canvas.node.width / 6 ) * 6 - 60;
            eventY = (canvas.node.height / 6 ) * 2 - 100;
            circlefillColor = '#cc0707'; 
            radius = 5;
            fillCircle(eventX, eventY, radius, circlefillColor);
            eventX = (canvas.node.width / 6 ) * 6 - 30;
            eventY = (canvas.node.height / 6 ) * 2 - 60;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if (!items[6][1] && document.getElementById('X4/Y6').hidden == true) { //cultist
            eventX = (canvas.node.width / 6 ) * 4 - 30;
            eventY = (canvas.node.height / 6 ) * 6 - 90;
            circlefillColor = '#0f0cc5'; 
            radius = 12;
            fillCircle(eventX, eventY, radius, circlefillColor);
        }
        if ( x == 5 && y == 5) {
            let cellCenter = 60;
            let pointX = (canvas.node.width / 6 ) * x - cellCenter;
            let pointY = (canvas.node.height / 6 ) * y - cellCenter;
            let radius = 15;
            let circlefillColor = '#8800ff';
            fillCircle(pointX, pointY, radius, circlefillColor);
        }
    }

    function createCanvas(parent) {
        canvas.node = document.createElement('canvas');
        canvas.context = canvas.node.getContext('2d');
        canvas.node.width = 720;
        canvas.node.height = 720;

        canvas.fillColor = '#1C00ff00';
        parent.appendChild(canvas.node);
    }

    function drawGrid() {
        let w = canvas.node.width;
        let h = canvas.node.height;
        canvas.context.strokeStyle = '#000000';
        canvas.context.lineWidth = 1;

        canvas.context.beginPath();
        for (var gridX = 0; gridX <= w; gridX += 120) {
            canvas.context.moveTo(gridX, 0);
            canvas.context.lineTo(gridX, h);
        }
        canvas.context.stroke();

        canvas.context.beginPath();
        for (var gridY = 0; gridY <= h; gridY += 120) {
            canvas.context.moveTo(0, gridY);
            canvas.context.lineTo(w, gridY);
        }
        canvas.context.stroke();
    }

    function initCanvas(container) {
        createCanvas(container);
        clearTo();
        drawPlayerLocation();
    }

    function fillCircle(x, y, radius, fillColor) {
        canvas.context.fillStyle = fillColor;
        canvas.context.beginPath();
        canvas.context.moveTo(x, y);
        canvas.context.arc(x, y, radius, 0, Math.PI * 2, false);
        canvas.context.fill();
    };

    function fillRectangle(x, y, l, b, fillColor) {
        canvas.context.fillStyle = fillColor;
        canvas.context.beginPath();
        canvas.context.moveTo(x, y);
        canvas.context.lineTo(x+l, y);
        canvas.context.lineTo(x+l, y+b);
        canvas.context.lineTo(x, y+b);
        canvas.context.lineTo(x, y);
        canvas.context.fill();
    };

    function drawPentagramm(x, y) {
        canvas.context.strokeStyle = '#000000';
        canvas.context.lineWidth = 1;
        canvas.context.beginPath();
        canvas.context.moveTo(x-28, y-12);
        canvas.context.lineTo(x+28, y-12);
        canvas.context.lineTo(x-20, y+21);
        canvas.context.lineTo(x, y-30);
        canvas.context.lineTo(x+20, y+21);
        canvas.context.lineTo(x-28, y-12);
        canvas.context.stroke();
    };

    function clearTo() {
        canvas.context.clearRect(0, 0, canvas.node.width, canvas.node.height);
    };

    function generateEvents() {
        //-----------------Items-------------------->
        //----["NAME", looked?, picked up?, used?]--->
        items.push(["rustykey", false, false, false]);
        items.push(["doll", true, false, false]);
        items.push(["casket", false, false, false]);
        items.push(["bottle", false, false, false]);
        items.push(["redorb", true, false, false]);
        items.push(["greenorb", true, false, false]);
        items.push(["blueorb", false, false, false]);
        items.push(["shield", false, false, false]);
        items.push(["goldenkey", true, false, false]);
        items.push(["redliquid", true, false, false]);
        //----------------Events-------------------->
        //----["NAME", used?]--->
        events.push(["chest", false]);
        events.push(["tree", false]);
        events.push(["gate", false]);
        events.push(["pentagramm", false]);
        events.push(["altarRed", false]);
        events.push(["altarGreen", false]);
        events.push(["altarBlue", false]);
        //-----------------NPCs--------------------->
        npc.push(["girl", false, false]);
        npc.push(["guy", false, false]);
        npc.push(["hunter", false, false]);
        npc.push(["cultist", false, false]);
    };

    async function exitGame() {
        console.log("exit");
        player = null || sessionStorage.getItem("player")
        if (player !== null) {
        var url = new URL(window.location.origin + '/exitgame');
        console.log("exit2");
        await fetch(url, 
            {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "PUT",
            body: JSON.stringify({score: scorePoints})
            })
            console.log("exit3");
        }
        window.location='/index.html';
    };

    async function wonGame() {
        scorePoints += Math.round(50000 / turns);
        console.log("won");
        confirm("Congratulations! You won the game!");
        player = null || sessionStorage.getItem("player")
        if (player !== null) {
        var url = new URL(window.location.origin + '/wongame');
        console.log("won2");
        await fetch(url, 
            {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "PUT",
            body: JSON.stringify({score: scorePoints})
            })
            console.log("won3");
        }
        window.location='/index.html';
    };

    async function updatedb(input) {
        console.log(input)
        player = null || sessionStorage.getItem("player")
        if (player !== null) {
            if (input == "north" || input == "n") {
                let url = new URL(window.location.origin + '/direction/north');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PUT",
                    body: JSON.stringify({x: x, y: y})
                    })
            } else if (input == "south" || input == "s") {
                let url = new URL(window.location.origin + '/direction/south');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PUT",
                    body: JSON.stringify({x: x, y: y})
                    })
            } else if (input == "east" || input == "e") {
                let url = new URL(window.location.origin + '/direction/east');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PUT",
                    body: JSON.stringify({x: x, y: y})
                    })
            } else if (input == "west" || input == "w") {
                let url = new URL(window.location.origin + '/direction/west');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PUT",
                    body: JSON.stringify({x: x, y: y})
                    })
            } else if (input == "look") {
                let url = new URL(window.location.origin + '/look');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PATCH",
                    body: JSON.stringify({lookDB: lookDB})
                    })
            } else if (input == "pickup") {
                let url = new URL(window.location.origin + '/pickup');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PATCH",
                    body: JSON.stringify({pickupDB: pickupDB})
                    })
            } else if (input.includes('use')) {
                let url = new URL(window.location.origin + '/use');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PATCH",
                    body: JSON.stringify({useDB: useDB})
                    })
            } else if (input == "talk") {
                let url = new URL(window.location.origin + '/talk');
                await fetch(url, 
                    {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "PATCH",
                    body: JSON.stringify({talkDB: talkDB})
                    })
            }
            lookDB = false;
            pickupDB = false;
            useDB = false;
            talkDB = false;
        }
    }
</script>
<script src="cellDetails.js"></script>

</body>
</html>
