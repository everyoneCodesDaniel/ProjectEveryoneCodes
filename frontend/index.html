<!DOCTYPE html>
<html>
<head>
<title>Browsergame</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AD09PRo+Pj4MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+Pj4MPj49Gv///wAAAAAAMDAwVS0tLc4rKyv+LCws7jU1NSoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0NDQqLCws7isrK/4tLS3OMTExVCsrK/AqKir/Kysr/ysrK/8uLi6qAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALi4uqisrK/8rKyv/Kioq/ywsLPAsLCzjKioq/zIyMv9UVFT/NTU1/DQzMy8tLS0KLS0tCi0tLQotLS0KMzMzLzk5OfxQUFD/LS0t/ysqKv8sLCzjLS0tni4uLv9PT0//8fHx/1VVVf8uLi79Ly8v/DQ0NPw0NDT8Ly8v/DAwMP1vb2///////z8/P/8tLS3/Li4tnjAwMFdtbW3/+fn5/7i4uP/7+/v/dHR0/39/f//9/f3//Pz8/4KCgv+dnZ3//////6mpqf//////U1NT/zAvL1dAQEAUQ0ND+3Fxcf/9/f3/c3Nz/0VFRf9IR0z/Y1iI/1iHaf9ITkr/TU1N/5WVlf//////dnZ2/zw8PPs9PT0U////AC0tLcc8PDz/hISE/0BAQP8rKir/Kyor/ysqLv8qLiv/Kisr/ysqKv9MTEz/oqKi/zIyMv8tLS3H////AAAAAAA0MzNKQEBA/z09Pf89PT3/LS0t3iwsLNssLCzbLCws2ywsLNsvLy/jPT09/z09Pf8+Pj76MzMzRQAAAAAAAAAA////AI+PjzyUlJRDkJCQPnl5eQIAAAAAAAAAAAAAAAAAAAAAeHh4BpOTkkGUlJRDjo6ONAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAAj/EAAAfgAAAH4AAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAQAAg8MAAP//AAD//wAA//8AAA==" rel="icon" type="image/x-icon">

<style>

html {
    height: 100%;
}

body {
    text-align: center;
    font-family: Monaco, monospace;
    background-image: linear-gradient(to bottom right, #0021A7, #AB0092);
}

.text {
    color: white;
}

button {
    width: 30%;
    padding: 5px 5px;
    font-family: Monaco, monospace;
    font-weight: bold;
    font-size: medium;
}

#login {
    float: right;
    margin-left: -50%;
    margin-top: 2em;
    margin-right: 1em;
    padding-left: 14px;
    padding-right: 14px;
}

#registrieren, #player, #logout {
    float: right;
    margin-left: -50%;
    margin-top: 2em;
    margin-right: 1em;
    padding-left: 14px;
    padding-right: 14px;
}

#about, #help, #player, #history, #rang, p {
    color: white;
}

.button2 {
    width: 150px;
    width: -moz-fit-content;
    padding: 5px 5px;
    font-family: Monaco, monospace;
    font-weight: bold;
    font-size: medium;
}

table.table1{
    margin-top: 30px;
    margin-bottom: 30px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid white;
    padding: 5px;
    text-align: center;
}

table.table1 th {
    margin-top: 30px;
    margin-bottom: 30px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid white;
    padding: 5px;
    text-align: center;
    width: 150px;
}

table.table1 td {
    margin-top: 30px;
    margin-bottom: 30px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid white;
    padding: 5px;
    text-align: center;
    width: 150px;
}

table.table2 {
    margin-top: 30px;
    margin-bottom: 30px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid white;
    padding: 5px;
    text-align: center;
}

table.table2 th{
    margin-top: 30px;
    margin-bottom: 30px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid white;
    padding: 5px;
    text-align: center;
}

table.table2 td{
    margin-top: 30px;
    margin-bottom: 30px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid white;
    padding: 5px;
    text-align: center;
}

ul {
  display: table;
  margin: 0 auto;
}

</style>  
</head>

<body onload="checkplayer()">

<div id="homepage">

    <button class="button2" id="login" onclick="window.location='/login.html'">Log In</button>
    <p id="player" hidden></p><br><br>
    <button class="button2" id="registrieren" onclick="window.location='/registrieren.html'">Sign Up</button>
    <button class="button2" id="logout" onclick="logoutplayer()" hidden>Log out</button>


    <h2 class="text">Abandoned</h2>
    <h3 class="text">The game</h3><br><br>

    <button id="start" onclick="startGame(player)">Start</button><br><br>
    <button id="historybutton" onclick="showHistory()">History</button><br><br>
    <button id="rangbutton" onclick="showScore()">Ranking</button><br><br>
    <button id="hilfe" onclick="showHelp()">Help</button><br><br>
    <button id="aboutbutton" onclick="displayAbout()">About</button><br><br>
    <button id="dbDelete" onclick="deleteAllDB()" hidden>Delete Database</button><br><br>

    <p>Please note: Sign up to save your runs and get the possibility to show former runs. 
        Otherwise the details of your run can't be saved.</p> 

</div>

<div id="history" hidden>
    <h2>History</h2>
    <div>
        <h3>Here you can see what you did in your last playthrough:</h3>
        <p>Legend:</p>
        <div>
            <table class="table2">
                <tr><th>Type</th><th>Description</th></tr>
                <tr><td>x</td><td>your interaction failed in this move</td></tr>
                <tr><td>o</td><td>your interaction was successful in this move</td></tr>
                <tr><td>null</td><td>you didn't interact in this move</td></tr>
                <tr><td>n</td><td>you went north</td></tr>
                <tr><td>s</td><td>you went south</td></tr>
                <tr><td>e</td><td>you went east</td></tr>
                <tr><td>w</td><td>you went west</td></tr>
            </table>
          </div>
        <div id="result"></div>
        <div id="historyshow"></div>
        <button class="button2" id="back" onclick="displayStart()">Back to start</button>
    </div>
</div>

<div id="rang" hidden>
    <h2>Ranking</h2>
    <div>
        <h3>Here you can see where you are in the ranking:</h3>
        <div id="score"></div>
        <div id="message"></div><br><br>
        <button class="button2" id="back" onclick="displayStart()">Back to start</button>
    </div>
</div>

<div id="help" hidden>
    <h2>How to play:</h2>
    <div>
        <p style="margin-right: 500px; margin-left: 500px; font-size: 20px;">This is a <u>browsergame</u> - so ensure you got a PC to play. 
            When you hit the start button you will get into the maze where you can move by <u>entering commands</u> into the chat window.
            You can read up all commands in the game. The goal of the game is to <u>exit the maze</u> by completing the necessary <u>quests</u>.
            While moving through the maze you can find and get <u>items</u> &#128302 and use them at another place. Furthermore you will find some <u>NPCs</u> &#128107 to talk to and to interact.
            And don't forget to beware of the <u>monsters</u>! ROOOOAAAR &#128121
        </p>
        <p>Have fun!</p>
        <button class="button2" id="back" onclick="displayStart()">Back to start</button>
    </div>
</div>

<div id="about" hidden>
    <h2>About</h2>
    <div>
        <h2>Welcome to our little Browsergame!</h2>
        <p style="font-size: 20px;">This game was developed by Daniel Schiefer and Aymara Cortez Espinoza for their final project at everyoneCodes. We hope you enjoy! &#127918</p>
        <button class="button2" id="back" onclick="displayStart()">Back to start</button>
    </div>
</div>

<script>
var player = null || sessionStorage.getItem("player");

async function startGame(player) {
    if (player !== null) {
        var url = new URL(window.location.origin + '/startgame/' + player);
        await fetch(url, {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "PUT",
        });
        console.log("Game Startedplayer!");
    }
    console.log("Game StartedAll!");
    window.location='/game.html';
}

async function deleteAllDB() {
    await fetch('/deleteAll', {
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        method: "DELETE",
    });
    console.log("DB deleted");
}

function logoutplayer() {
    player = null;
    document.getElementById('login').hidden = false;
    document.getElementById('player').hidden = true;
    document.getElementById('registrieren').hidden = false;
    document.getElementById('logout').hidden = true;
    document.getElementById('dbDelete').hidden = true;
    sessionStorage.clear(); 

    let url = new URL(window.location.origin + '/logout');
        fetch(url, 
        {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "GET"
        })
}

function checkplayer() {
    console.log(player)
    if (player !== null) {
        document.getElementById('player').innerHTML = 'Logged in as: ' + player;
        document.getElementById('login').hidden = true;
        document.getElementById('player').hidden = false;
        document.getElementById('registrieren').hidden = true;
        document.getElementById('logout').hidden = false;
    } else {
        document.getElementById('login').hidden = false;
        document.getElementById('player').hidden = true;
        document.getElementById('registrieren').hidden = false;
        document.getElementById('logout').hidden = true;
    }
    if (player === 'Aymara' || player === "Daniel") {
        document.getElementById('dbDelete').hidden = false;
    } else {
        document.getElementById('dbDelete').hidden = true;
    }
}

function displayAbout() {
    document.getElementById('homepage').hidden = true;
    document.getElementById('about').hidden = false;
    document.getElementById('help').hidden = true;
    document.getElementById('history').hidden = true;
    document.getElementById('rang').hidden = true;
}

function displayStart() {
    document.getElementById('homepage').hidden = false;
    document.getElementById('about').hidden = true;
    document.getElementById('help').hidden = true;
    document.getElementById('history').hidden = true;
    document.getElementById('rang').hidden = true;
}

async function showHistory() {
    document.getElementById('history').hidden = false;
    document.getElementById('homepage').hidden = true;
    document.getElementById('about').hidden = true;
    document.getElementById('help').hidden = true;
    document.getElementById('rang').hidden = true;

    if (player !== null) {
    var url = new URL(window.location.origin + '/history/' + player);
    let result = await fetch(url, {
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        method: "GET",
    });

    let data = await result.json();
    console.log(data)
    document.getElementById('result').innerHTML = "Result: " + data.ergebnis;
    var table = '<table class="table2">';
    table += "<tr><th>Move</th><th>Look</th><th>Pickup</th><th>Use</th><th>Talk</th><th>Direction</th><th>Position</th></tr>";
    for (var row of data.rows) {
        table += `<tr><td>${row.zuganzahl}</td><td>${row.look}</td><td>${row.pickup}</td>
            <td>${row.apply}</td><td>${row.talk}</td><td>${row.richtung}</td><td>${row.position}</td></tr>`; 
    }
    table += "</table>";
    document.getElementById('historyshow').innerHTML = table;
} else if (player === null) {
    document.getElementById('historyshow').innerHTML = "You don't have an account - create one to show your last run. <br><br>"
}
}

async function showScore() {
    document.getElementById('rang').hidden = false;
    document.getElementById('history').hidden = true;
    document.getElementById('homepage').hidden = true;
    document.getElementById('about').hidden = true;
    document.getElementById('help').hidden = true;

    var url = new URL(window.location.origin + '/score');
    let result = await fetch(url, {
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        method: "GET",
    });

    let counter = 1;
    let data = await result.json();
    console.log(data)
    var table = '<table class="table1">';
    table += "<tr><th>Place</th><th>Username</th><th>Moves</th><th>Result</th><th>Score</th></tr>";
    for (var row of data.rows) {
        table += `<tr><td>${counter++}</td><td>${row.username}</td><td>${row.zuganzahl}</td><td>${row.result}</td><td>${row.score}</td></tr>`; 
    }
    table += "</table>";
    document.getElementById('score').innerHTML = table;
    if (player === null) {
        document.getElementById('message').innerHTML = "You don't have an account - create one to get listed.";
    }
}

function showHelp() {
    document.getElementById('homepage').hidden = true;
    document.getElementById('about').hidden = true;
    document.getElementById('help').hidden = false;
    document.getElementById('history').hidden = true;
    document.getElementById('rang').hidden = true;
}

</script>

</body>
</html>
